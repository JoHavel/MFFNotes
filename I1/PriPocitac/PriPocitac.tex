\documentclass[12pt]{article}					% Začátek dokumentu
\usepackage{../../MFFStyle}					    % Import stylu



\begin{document}
\section{Organizační úvod}
    Budeme se zabývat hlavně hardwarem + Operační systémy v letním semestru tím zbytkem. Volně navazuje i architektura počítačů v LS 2. ročníku. Chce se po nás umět souvislosti a termíny (občas budou české, ale vždy i s anglickou variantou). Budeme si lhát sofistikovaně.

\section{Harvardská architektura}
    Podle univerzity
    \begin{itemize}
        \item procesor (CPU) -- základní výpočetní jednotka
        \item kódová paměť (code memory) -- paměť
        \item propojení -- CPU přes něj čte data z paměti (měnit program (tedy to, co je v této paměti) neumí)
        \item datová paměť (data memory) -- proměnné, lze do ni zapisovat (W) i z ní číst (R)
        \item input / output (I/O, tzv. periferie) -- komunikace s okolím
    \end{itemize}
    Anglický (chudý) matematik Charles Babbage navrhl \emph{Analytical engine} (1837, pohonem byl parní stroj, měl počítat daně), který měl tuto architekturu.
    
    Ada Lovelace jeho manželka napsala manuál k Analytical engine (jako matematik to moc nepopsal). Zároveň vymyslela, že kromě čísel by šlo předávat i zakódovaná písmena, noty, atd.
    
\section{Reprezentace (celých) čísel}
    \subsection{přenos}
        \begin{itemize}
            \item Můžeme reprezentovat analogově 1 jedním voltem, 2 dvěma, $10^6$milionů.
            \item Můžeme použít i jinak naškálovanou hodnotu, 1 tisícinou voltu, 2 dvěma tisícinami $10^6$ 1000 voltů. Vodiče ale nejsou ideální vodiče, mění odpor / proud podle délky, tepla a elektromagnetického pole v okolí.
            \item Můžeme používat digitální (číslicový) přenos, třeba (někdy je to opačně): napětí nad nějakou hodnotou jako 1 a napětí pod tu hodnotou jako 0 (většinou je ta mez širší jen bod). Jedna taková hodnota je 1 bit (b). Přenášíme tzv. sériovým přenosem, každý bit chvíli (diagram zobrazující tenhle přenos je tzv. timing diagram).
            \item 1 a 0 jde i jinak, přes dva vodiče, podle směru jejich rozdílu (kladný vs. záporný rozdíl), což má navíc výhodu, že jsou šumem ovlivněny téměř stejně. Tzv. diferenciální přenos (např. USB).
        \end{itemize}
        \begin{upozorneni}
                Napětí je relativní! (Musíme, krom diferenciálního přenosu, měřit oproti nějaké „nule“, tzv. zemi (ground).)
        \end{upozorneni}
        \begin{upozorneni}
            Zdroj pracuje jen v uzavřeném obvodu!
        \end{upozorneni}
        \begin{poznamka}[Mocniny 2]
            Hodí se naučit se mocniny 2: $2^4 = 64; 2^8 = 256; 2^10 = 1024; 2^12 = 4096; 2^16 = 65536; 2^20 \approx 10^6; 2^30 \approx 4,2\cdot 10^9$
        \end{poznamka}
        \begin{definice}[Most significant bit (MSb)]
            Bit s nejvyšší hodnotou (nejvyšší mocninou 2).
        \end{definice}
        \begin{definice}[Least significant bit (LSb)]
            Bit s nejnižší hodnotou (nejnižší mocninou 2, typicky $2^0$).
        \end{definice}
        \begin{definice}[Bitorder]
            Pořadí, v jakém se bity posílají (MSb-first / LSb-first)
        \end{definice}
        \begin{definice}[Přenosová rychlost (transfer rate)]
                Rychlost, udává se v b / s (bps) nebo bauds (=symbols=včetně nedatových věcí jako mezery mezi „pakety“) / s.
        \end{definice}
        
        \begin{definice}[Idle stav linky]
                Když se nic nepřenáší (lze vytvořit stavem vysoké impedance, nebo tím, že definujeme 1 / 0 jako idle stav a přenos je započat  tzv. start condition = změna na 0 / 1 (jelikož je lepší start condition mít delší, tak se vysílá délkou 1 bit tzv. startbit)).
            \begin{definice}[stav Vysoké impedance = high Z]
                Místo zapojení do 1 / do 0 vypojíme vysílací linku. Tento stav pak lze detekovat u přijímajícího).
            \end{definice}
        \end{definice}

        \begin{poznamka}[Hodiny a synchronizace]
             Start condition (začátek start condition je tzv. raising edge, na ní se právě synchronizuje) může dokonce synchronizovat čas.

             Navíc hodiny nejsou přesné, takže po nějaké době budou rozsynchronizované. To lze vyřešit buď omezením délky přenosu. Většinou se však definuje délka, protože posílat end znak je těžké, tedy se dohodlo 8 bitů = 1 byte = 8b = 1B. (Avšak starší počítače měli i jinou velikost 1B).

             Po 1 přenosu však musí být pauza, aby se mohli zase synchronizovat hodiny, tedy se přenáší stopbity (začínají falling edge) (musí se dohodnout jejich počet, často 1).

             To už začíná být moc zbytečných bitů, proto se přidává další signál -- hodinový (střídající se 1 a 0, na hranách (ať už vzestupných nebo sestupných podle dohody, výjimečně ddr = double data rate = obojí) je střed bitu). Hodinový signál může vycházet buď od odesílatele, nebo z vnějšího zdroje pro oba.

             Ten má ale problém, že se může (třeba různými délkami drátu) rozladit. Proto existuje 3 řešení: pravidelná synchronizace na hranách přenášeného signálu (clock recovery = obnovování hodin), aby se to nerozbíjelo na dlouhých shodných úsecích, existuje zakódování 8 bitů do 10 (nebo jiné, podle dohody), aby se nestalo, že všech 8 (nyní 10) bude jen 1 nebo jen 0 (např. USB, nebo RS232).
        \end{poznamka}

        \begin{poznamka}[Duplexní přenos]
            Zatím jsme řešili jen jednostrannou komunikaci (= simplexní přenos), ale v mnoha reálných situacích chceme tzv. duplexní přenos.

            Nejjednodušší je halfduplex = přenáší se oběma směry po jedné lince.

            Fullduplex jsou naopak 2 nezávislé jednosměrné (simplexní) linky (mohou mít společný ground) (např. RS232). Např. v RS232 je navíc linka pro tzv. out of bend signály (většinou buď 1 = pravda nebo 0 = nepravda, resp. tzv. inverzní logika značená overline) jako třeba warning nebo error (třeba 1 kabel pro informaci dochází baterka…).
        \end{poznamka}

        \begin{definice}[Řadič]
            Dále je nutné definovat komunikační protokol, který může definovat různorodé pakety. Přijímání (tzn. třeba přechod z 7b na 8b byte, nebo LSb-first / MSb-first) má na starost tzv. řadič (= controller), paměti v řadiči se říká registr (= register).

            Registry jsou podle funkce pojmenovány např. datový, buffer, konfigurační (pro konfiguraci např. rychlosti linky…), …
        \end{definice}

% 13. 10. 2020
        
        \begin{upozorneni}
            Kromě čtení registrů potřebujeme i nastavit napájení myši a nejlépe ji i resetovat.
        \end{upozorneni}

        \begin{poznamka}
            Dále jsme probírali dvojkovou a 16kovou soustavu + bitwise operace.
        \end{poznamka}

% 27. 10. 2020

        \begin{poznamka}
            Včetně bitového posunu (shl = shift left = posouvá k MSb, ne doleva, …). A bitových rotací.
        \end{poznamka}

        \begin{poznamka}
            Dále jsme řešili reprezentaci záporných čísel (nejdříve 1 znaménkový bit, následně bitový doplněk a nakonec dvojkový doplněk).
        \end{poznamka}

        \begin{upozorneni}
            Čísla v Pythonu jsou divná. Proto jsme si ukazovali knihovnu NumPy, kde si můžeme požádat o konkrétně dlouhé číslo (abychom nepřišli o nulu na začátku).
        \end{upozorneni}

% 3. 11. 2020

        \begin{definice}[Master / slave]
            Zařízením na jedné lince se říká master a slave, podle toho, kdo požaduje věci od koho. V počítači je často procesor master a slave budou tzv. zařízení (device).
        \end{definice}

        \begin{definice}[Multigroup linka = bus (sběrnice)]
            Procesor by musel mít zadrátováno mnoho linek, ale to je nepraktické, takže existují sběrnice (často se ale sběrnice říká i linkám). Na sběrnici je napojeno mnoho zařízení a v podstatě každé má tzv. adresu (masteři nemusí, ale také mohou). Každé zařízení musí být rozděleno na 2 části: r (receiver) a t (transmitter).

            Aby nebyla sběrnice v nedefinovaném stavu, dělá se, že se na sběrnici připojí pull-up rezistor (napětí, tj. 1, připojené přes velký rezistor). Sběrnice se pak chová k vysílajícím signálům jako AND.
        \end{definice}

        \begin{definice}[$I^2 C$ = Inter Integrated Circuit]
            Pomalá. Ideální na krátká propojení integrovaných obvodů. Řadič SDA (serial data). Má vestavěný hodinový signál SCL (serial clock) (v 0 se data mění, v 1 platí) (tiká pouze při komunikaci, generuje ho konkrétní master, který komunikuje).

            Tzv. multimaster (může být více materů). Narozdíl třeba od USB sběrnice, která je singlemaster.

            Přenos se startuje a ukončuje změnou stavu z jedné na nulu a z nuly na jedničku, když je hodinový signál 1 (neměl by se měnit).

            Je devítibitový byte (8 data + 1 bit tzv. acknowledgement (= ACK = potvrzeno) (NACK = odmítnuto), potvrzení generuje přijímající). MSb-first. 1 = NACK, 0 = ACK, 1 se používá třeba pro ukončení přenosu, když má proměnnou délku, zároveň první potvrzuje, zda se zde zařízení, které je oslovováno, nachází. 100 kHz - 5 MHz.

            Po sběrnici se přenáší pakety složené z management části (7bitová adresa + bit read = not write) a tzv. payloadu (dat, co chceme přenést).

            Když slave nestíhá, může udržet hodinový signál v nule (tzv. clock stretching).
        \end{definice}

        \begin{priklady}[ALS = Ambient Light Sensor (konkrétní od everlight)]
            (Detekuje intenzitu světla.) Má cca registr (ADC registr = analog digital converter = analog digitální převodník), který se při každém průletu fotonu zvýší o 1 (začátek = vynulování a konec si volíme sami při komunikaci).

            Registr 2 bytový, 15 bitů číslo, 1 bit měří / neměří. Má adresu 0x29 danou od výrobce. Má pouze 1 read only (R/O) registr (počítací), má 1 write only (W/O) registr (příkazový), nemá žádný read write (R/W) registr.

            Data se posílají LSB (sběrnice je MSb, zařízení LSB).
        \end{priklady}

\end{document}
